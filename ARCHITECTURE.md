# COSMOS ç¨‹åºæ¶æ„æ–‡æ¡£

## æ¦‚è¿°

**COSMOS** (COordinated Safety On Manifold for multi-agent Systems) æ˜¯ä¸€ä¸ªç”¨äºå®‰å…¨å¤šæ™ºèƒ½ä½“å¼ºåŒ–å­¦ä¹ çš„ç»Ÿä¸€æ¡†æ¶ï¼Œæ”¯æŒå¤šç§ç¯å¢ƒã€ç®—æ³•å’Œå®‰å…¨æ»¤æ³¢å™¨çš„çµæ´»ç»„åˆã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           COSMOS æ¶æ„æ€»è§ˆ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚   ç¯å¢ƒå±‚    â”‚    â”‚   ç®—æ³•å±‚    â”‚    â”‚   å®‰å…¨å±‚    â”‚    â”‚   è¿è¡Œå±‚    â”‚ â”‚
â”‚   â”‚             â”‚    â”‚             â”‚    â”‚             â”‚    â”‚             â”‚ â”‚
â”‚   â”‚ FormationNavâ”‚    â”‚   MAPPO     â”‚    â”‚    CBF      â”‚    â”‚  Trainer    â”‚ â”‚
â”‚   â”‚ EpuckSim   â”‚    â”‚   QMIX      â”‚    â”‚   COSMOS    â”‚    â”‚  Runners    â”‚ â”‚
â”‚   â”‚ SafetyGym  â”‚    â”‚   MADDPG    â”‚    â”‚   ATACOM    â”‚    â”‚  Buffers    â”‚ â”‚
â”‚   â”‚ MuJoCo     â”‚    â”‚             â”‚    â”‚             â”‚    â”‚             â”‚ â”‚
â”‚   â”‚ VMAS       â”‚    â”‚             â”‚    â”‚             â”‚    â”‚             â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          â”‚                  â”‚                  â”‚                  â”‚        â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                    â”‚                                        â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                         â”‚      Registry       â”‚                            â”‚
â”‚                         â”‚   (ç»„ä»¶æ³¨å†Œä¸­å¿ƒ)     â”‚                            â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                    â”‚                                        â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                         â”‚   Hydra Config      â”‚                            â”‚
â”‚                         â”‚   (é…ç½®ç®¡ç†)         â”‚                            â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸€ã€ç›®å½•ç»“æ„

```
safe-rl-manifold-suite/
â”‚
â”œâ”€â”€ cosmos/                          # ğŸ¯ æ ¸å¿ƒæ¡†æ¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ registry.py                  # ç»„ä»¶æ³¨å†Œå™¨
â”‚   â”œâ”€â”€ train.py                     # Hydra è®­ç»ƒå…¥å£
â”‚   â”œâ”€â”€ trainer.py                   # ç»Ÿä¸€è®­ç»ƒå™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ configs/                     # Hydra é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ config.yaml              # ä¸»é…ç½®
â”‚   â”‚   â”œâ”€â”€ env/                     # ç¯å¢ƒé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ formation_nav.yaml
â”‚   â”‚   â”‚   â”œâ”€â”€ epuck_sim.yaml
â”‚   â”‚   â”‚   â”œâ”€â”€ safety_gym.yaml
â”‚   â”‚   â”‚   â”œâ”€â”€ mujoco.yaml
â”‚   â”‚   â”‚   â””â”€â”€ vmas.yaml
â”‚   â”‚   â”œâ”€â”€ algo/                    # ç®—æ³•é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ mappo.yaml
â”‚   â”‚   â”‚   â”œâ”€â”€ qmix.yaml
â”‚   â”‚   â”‚   â””â”€â”€ maddpg.yaml
â”‚   â”‚   â””â”€â”€ safety/                  # å®‰å…¨æ»¤æ³¢å™¨é…ç½®
â”‚   â”‚       â”œâ”€â”€ cosmos.yaml
â”‚   â”‚       â”œâ”€â”€ cbf.yaml
â”‚   â”‚       â””â”€â”€ none.yaml
â”‚   â”‚
â”‚   â”œâ”€â”€ envs/                        # ç¯å¢ƒå°è£…
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                  # BaseMultiAgentEnv åŸºç±»
â”‚   â”‚   â”œâ”€â”€ formation_nav.py         # ç¼–é˜Ÿå¯¼èˆªç¯å¢ƒ
â”‚   â”‚   â”œâ”€â”€ webots_wrapper.py        # Webots/E-puck ç¯å¢ƒ
â”‚   â”‚   â”œâ”€â”€ safety_gym_wrapper.py    # Safety-Gymnasium å°è£…
â”‚   â”‚   â”œâ”€â”€ mujoco_wrapper.py        # MuJoCo å°è£…
â”‚   â”‚   â”œâ”€â”€ vmas_wrapper.py          # VMAS å°è£…
â”‚   â”‚   â””â”€â”€ epuck_visualizer.py      # E-puck å¯è§†åŒ–
â”‚   â”‚
â”‚   â”œâ”€â”€ algos/                       # MARL ç®—æ³•
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                  # BaseMARLAlgo åŸºç±»
â”‚   â”‚   â”œâ”€â”€ mappo.py                 # MAPPO å®ç°
â”‚   â”‚   â”œâ”€â”€ qmix.py                  # QMIX å®ç°
â”‚   â”‚   â””â”€â”€ maddpg.py                # MADDPG å®ç°
â”‚   â”‚
â”‚   â”œâ”€â”€ safety/                      # å®‰å…¨æ»¤æ³¢å™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                  # BaseSafetyFilter åŸºç±»
â”‚   â”‚   â””â”€â”€ cosmos_filter.py         # CBF/COSMOS å®ç°
â”‚   â”‚
â”‚   â”œâ”€â”€ buffers/                     # ç»éªŒç¼“å†²åŒº
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ rollout_buffer.py        # On-policy ç¼“å†²åŒº
â”‚   â”‚   â””â”€â”€ replay_buffer.py         # Off-policy ç¼“å†²åŒº
â”‚   â”‚
â”‚   â””â”€â”€ runners/                     # è®­ç»ƒè¿è¡Œå™¨
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ episode_runner.py        # å•çº¿ç¨‹è¿è¡Œå™¨
â”‚       â””â”€â”€ parallel_runner.py       # å¹¶è¡Œè¿è¡Œå™¨
â”‚
â”œâ”€â”€ formation_nav/                   # ğŸ“ ç¼–é˜Ÿå¯¼èˆªæ¨¡å—
â”‚   â”œâ”€â”€ algo/                        # MAPPO åŸå§‹å®ç°
â”‚   â”œâ”€â”€ env/                         # ç¼–é˜Ÿç¯å¢ƒ
â”‚   â”œâ”€â”€ safety/                      # ATACOM/COSMOS/RMPflow
â”‚   â””â”€â”€ docs/                        # ç†è®ºæ–‡æ¡£
â”‚
â”œâ”€â”€ ros2_ws/                         # ğŸ¤– ROS2 éƒ¨ç½²
â”‚   â””â”€â”€ src/epuck_formation/         # E-puck ROS2 åŒ…
â”‚       â”œâ”€â”€ package.xml
â”‚       â”œâ”€â”€ CMakeLists.txt
â”‚       â”œâ”€â”€ launch/                  # å¯åŠ¨æ–‡ä»¶
â”‚       â”œâ”€â”€ scripts/                 # èŠ‚ç‚¹è„šæœ¬
â”‚       â”œâ”€â”€ worlds/                  # Webots ä¸–ç•Œæ–‡ä»¶
â”‚       â””â”€â”€ config/                  # å‚æ•°é…ç½®
â”‚
â”œâ”€â”€ docs/                            # ğŸ“š æ–‡æ¡£
â”‚   â””â”€â”€ ROS2_WEBOTS_SETUP.md
â”‚
â”œâ”€â”€ scripts/                         # ğŸ”§ å·¥å…·è„šæœ¬
â”‚   â””â”€â”€ analyze_results.py
â”‚
â”œâ”€â”€ test_all_envs.py                 # âœ… æµ‹è¯•å¥—ä»¶
â”œâ”€â”€ setup.sh                         # å®‰è£…è„šæœ¬
â”œâ”€â”€ setup.py                         # pip å®‰è£…é…ç½®
â””â”€â”€ run_experiments.sh               # å®éªŒè„šæœ¬
```

---

## äºŒã€æ ¸å¿ƒç»„ä»¶æ¶æ„

### 2.1 Registry æ¨¡å¼ (ç»„ä»¶æ³¨å†Œ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Registry Pattern                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   @ENV_REGISTRY.register("formation_nav")                   â”‚
â”‚   class FormationNavEnv(BaseMultiAgentEnv):                 â”‚
â”‚       ...                                                   â”‚
â”‚                                                             â”‚
â”‚   @ALGO_REGISTRY.register("mappo")                          â”‚
â”‚   class MAPPO(BaseMARLAlgo):                                â”‚
â”‚       ...                                                   â”‚
â”‚                                                             â”‚
â”‚   @SAFETY_REGISTRY.register("cbf")                          â”‚
â”‚   class CBFFilter(BaseSafetyFilter):                        â”‚
â”‚       ...                                                   â”‚
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    Registry                          â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  ENV_REGISTRY:                                       â”‚   â”‚
â”‚   â”‚    "formation_nav" â†’ FormationNavEnv                 â”‚   â”‚
â”‚   â”‚    "epuck_sim"     â†’ EpuckSimEnv                     â”‚   â”‚
â”‚   â”‚    "safety_gym"    â†’ SafetyGymWrapper                â”‚   â”‚
â”‚   â”‚    "mujoco"        â†’ MuJoCoWrapper                   â”‚   â”‚
â”‚   â”‚    "vmas"          â†’ VMASWrapper                     â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  ALGO_REGISTRY:                                      â”‚   â”‚
â”‚   â”‚    "mappo"   â†’ MAPPO                                 â”‚   â”‚
â”‚   â”‚    "qmix"    â†’ QMIX                                  â”‚   â”‚
â”‚   â”‚    "maddpg"  â†’ MADDPG                                â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  SAFETY_REGISTRY:                                    â”‚   â”‚
â”‚   â”‚    "cbf"     â†’ CBFFilter                             â”‚   â”‚
â”‚   â”‚    "cosmos"  â†’ COSMOSFilter                          â”‚   â”‚
â”‚   â”‚    "none"    â†’ NoFilter                              â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç±»ç»§æ‰¿ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ç±»ç»§æ‰¿å…³ç³»                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   BaseMultiAgentEnv (ABC)                                                   â”‚
â”‚   â”œâ”€â”€ FormationNavEnv          # ç¼–é˜Ÿå¯¼èˆª                                   â”‚
â”‚   â”œâ”€â”€ EpuckSimEnv              # E-puck ä»¿çœŸ                                â”‚
â”‚   â”œâ”€â”€ WebotsEpuckEnv           # Webots E-puck                             â”‚
â”‚   â”œâ”€â”€ SafetyGymWrapper         # Safety-Gymnasium                          â”‚
â”‚   â”œâ”€â”€ MuJoCoWrapper            # MuJoCo                                    â”‚
â”‚   â””â”€â”€ VMASWrapper              # VMAS                                      â”‚
â”‚                                                                             â”‚
â”‚   BaseMARLAlgo (ABC)                                                        â”‚
â”‚   â”œâ”€â”€ MAPPO                    # Multi-Agent PPO                           â”‚
â”‚   â”œâ”€â”€ QMIX                     # Value Decomposition                       â”‚
â”‚   â””â”€â”€ MADDPG                   # Multi-Agent DDPG                          â”‚
â”‚                                                                             â”‚
â”‚   BaseSafetyFilter (ABC)                                                    â”‚
â”‚   â”œâ”€â”€ CBFFilter                # Control Barrier Function                  â”‚
â”‚   â”œâ”€â”€ COSMOSFilter             # Manifold Projection                       â”‚
â”‚   â””â”€â”€ NoFilter                 # Pass-through (baseline)                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æ•°æ®æµæ¶æ„

### 3.1 è®­ç»ƒæ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           è®­ç»ƒæ•°æ®æµ                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚  Env    â”‚â”€â”€â”€â”€â–¶â”‚ Policy  â”‚â”€â”€â”€â”€â–¶â”‚ Safety  â”‚â”€â”€â”€â”€â–¶â”‚  Env    â”‚             â”‚
â”‚   â”‚ (obs)   â”‚     â”‚(action) â”‚     â”‚(project)â”‚     â”‚ (step)  â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚        â”‚                                               â”‚                   â”‚
â”‚        â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚                   â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Buffer  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                        â”‚(store)  â”‚                                         â”‚
â”‚                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                         â”‚
â”‚                             â”‚                                              â”‚
â”‚                        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                                         â”‚
â”‚                        â”‚ Update  â”‚                                         â”‚
â”‚                        â”‚(policy) â”‚                                         â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                             â”‚
â”‚   è¯¦ç»†æµç¨‹:                                                                 â”‚
â”‚   1. env.reset() â†’ obs, share_obs                                          â”‚
â”‚   2. policy.get_actions(obs) â†’ actions, log_probs                          â”‚
â”‚   3. safety.project(actions, constraint_info) â†’ safe_actions               â”‚
â”‚   4. env.step(safe_actions) â†’ next_obs, rewards, costs, dones              â”‚
â”‚   5. buffer.insert(obs, actions, rewards, costs, ...)                      â”‚
â”‚   6. buffer.compute_returns() â†’ advantages                                 â”‚
â”‚   7. policy.update(buffer) â†’ loss metrics                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å®‰å…¨æ»¤æ³¢æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CBF å®‰å…¨æ»¤æ³¢å™¨æ•°æ®æµ                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   è¾“å…¥:                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚  nominal_action â”‚    â”‚ constraint_info â”‚                               â”‚
â”‚   â”‚     u_nom       â”‚    â”‚   positions     â”‚                               â”‚
â”‚   â”‚   (N, act_dim)  â”‚    â”‚   velocities    â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   obstacles     â”‚                               â”‚
â”‚            â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚            â”‚                      â”‚                                        â”‚
â”‚            â–¼                      â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚   â”‚         CBF Constraint Construction      â”‚                              â”‚
â”‚   â”‚                                         â”‚                              â”‚
â”‚   â”‚  h(x) = ||p_i - p_j||Â² - d_safeÂ²       â”‚  â† ç¢°æ’é¿å…                   â”‚
â”‚   â”‚  á¸£(x) + Î±h(x) â‰¥ 0                      â”‚  â† CBF æ¡ä»¶                   â”‚
â”‚   â”‚                                         â”‚                              â”‚
â”‚   â”‚  æ„å»º QP: min ||u - u_nom||Â²           â”‚                              â”‚
â”‚   â”‚           s.t. AÂ·u â‰¥ b                 â”‚                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚   â”‚            QP Solver (æŠ•å½±æ¢¯åº¦ä¸‹é™)       â”‚                              â”‚
â”‚   â”‚                                         â”‚                              â”‚
â”‚   â”‚  u* = u_nom + Î·Â·A^TÂ·Î»                  â”‚                              â”‚
â”‚   â”‚  Î» = max(0, b - AÂ·u)                   â”‚                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      â”‚
â”‚   â”‚   safe_action   â”‚                                                      â”‚
â”‚   â”‚      u*         â”‚                                                      â”‚
â”‚   â”‚   (N, act_dim)  â”‚                                                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€ç¯å¢ƒæ¥å£

### 4.1 BaseMultiAgentEnv æ¥å£

```python
class BaseMultiAgentEnv(ABC):
    """å¤šæ™ºèƒ½ä½“ç¯å¢ƒåŸºç±»"""

    # å±æ€§
    @property
    def num_agents(self) -> int: ...
    @property
    def observation_space(self) -> gym.Space: ...
    @property
    def action_space(self) -> gym.Space: ...
    @property
    def share_observation_space(self) -> gym.Space: ...

    # ç»´åº¦æŸ¥è¯¢
    def get_obs_dim(self) -> int: ...
    def get_act_dim(self) -> int: ...
    def get_share_obs_dim(self) -> int: ...

    # æ ¸å¿ƒæ–¹æ³•
    def reset(self, seed=None) -> Tuple[obs, share_obs, info]: ...
    def step(self, actions) -> Tuple[obs, share_obs, rewards, costs, dones, infos, truncated]: ...
    def get_constraint_info(self) -> Dict: ...
    def render(self, mode="human"): ...
    def close(self): ...
```

### 4.2 ç¯å¢ƒå¯¹æ¯”

| ç¯å¢ƒ | ç±»å‹ | æ™ºèƒ½ä½“æ•° | è§‚æµ‹ç»´åº¦ | åŠ¨ä½œç»´åº¦ | é€Ÿåº¦ |
|------|------|---------|---------|---------|------|
| formation_nav | å†…ç½® | å¯å˜ | 30 | 2 | ~10k FPS |
| epuck_sim | å†…ç½® | å¯å˜ | 16 | 2 | ~5k FPS |
| safety_gym | å°è£… | 1 | 60 | 2 | ~1k FPS |
| mujoco | å°è£… | å¯å˜ | 27+ | 4+ | ~2k FPS |
| vmas | å°è£… | å¯å˜ | å¯å˜ | 2 | ~3k FPS |

---

## äº”ã€ç®—æ³•æ¶æ„

### 5.1 MAPPO (Multi-Agent PPO)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MAPPO æ¶æ„                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚                         Actor Network                             â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚     â”‚
â”‚   â”‚  â”‚  obs_i  â”‚â”€â”€â”€â–¶â”‚ Linear  â”‚â”€â”€â”€â–¶â”‚  ReLU   â”‚â”€â”€â”€â–¶â”‚ Linear  â”‚â”€â”€â–¶ Î¼  â”‚     â”‚
â”‚   â”‚  â”‚ (N,obs) â”‚    â”‚   128   â”‚    â”‚         â”‚    â”‚ act_dim â”‚       â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚     â”‚
â”‚   â”‚                                                         â”€â”€â–¶ Ïƒ   â”‚     â”‚
â”‚   â”‚                                                                  â”‚     â”‚
â”‚   â”‚  è¾“å‡º: actions ~ N(Î¼, ÏƒÂ²), log_probs                            â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚                        Critic Network (CTDE)                      â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚     â”‚
â”‚   â”‚  â”‚share_obsâ”‚â”€â”€â”€â–¶â”‚ Linear  â”‚â”€â”€â”€â–¶â”‚  ReLU   â”‚â”€â”€â”€â–¶â”‚ Linear  â”‚â”€â”€â–¶ V  â”‚     â”‚
â”‚   â”‚  â”‚(N,share)â”‚    â”‚   128   â”‚    â”‚         â”‚    â”‚    1    â”‚       â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚     â”‚
â”‚   â”‚                                                                  â”‚     â”‚
â”‚   â”‚  è¾“å‡º: value estimates V(s)                                     â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â”‚   è®­ç»ƒç›®æ ‡:                                                                 â”‚
â”‚   L_actor = -min(rÂ·A, clip(r,1-Îµ,1+Îµ)Â·A) - Î²Â·H(Ï€)                         â”‚
â”‚   L_critic = (V - V_target)Â²                                               â”‚
â”‚                                                                             â”‚
â”‚   å…¶ä¸­: r = Ï€(a|s)/Ï€_old(a|s), A = GAE advantages                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 QMIX (Value Decomposition)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              QMIX æ¶æ„                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Agent Networks (æ¯ä¸ªæ™ºèƒ½ä½“):                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚   â”‚  obs_i  â”‚â”€â”€â”€â–¶â”‚  GRU    â”‚â”€â”€â”€â–¶â”‚ Linear  â”‚â”€â”€â”€â–¶ Q_i(s_i, a)               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  (64)   â”‚    â”‚n_actionsâ”‚                                â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                             â”‚
â”‚   Mixing Network:                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚                                                                 â”‚      â”‚
â”‚   â”‚   Q_1 â”€â”€â”                                                       â”‚      â”‚
â”‚   â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚      â”‚
â”‚   â”‚   Q_2 â”€â”€â”¼â”€â”€â”€â–¶â”‚  Hypernetwork â”‚â”€â”€â”€â–¶ Q_tot                       â”‚      â”‚
â”‚   â”‚         â”‚    â”‚  (æ­£æƒé‡çº¦æŸ)  â”‚                                   â”‚      â”‚
â”‚   â”‚   Q_N â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚      â”‚
â”‚   â”‚                     â–²                                           â”‚      â”‚
â”‚   â”‚                     â”‚                                           â”‚      â”‚
â”‚   â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                    â”‚      â”‚
â”‚   â”‚              â”‚ global_state â”‚                                    â”‚      â”‚
â”‚   â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚      â”‚
â”‚   â”‚                                                                 â”‚      â”‚
â”‚   â”‚   çº¦æŸ: âˆ‚Q_tot/âˆ‚Q_i â‰¥ 0 (å•è°ƒæ€§)                               â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                             â”‚
â”‚   è®­ç»ƒç›®æ ‡: L = (Q_tot - (r + Î³Â·max Q_tot'))Â²                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 MADDPG (Multi-Agent DDPG)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            MADDPG æ¶æ„                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   æ¯ä¸ªæ™ºèƒ½ä½“ i:                                                              â”‚
â”‚                                                                             â”‚
â”‚   Actor Î¼_i:  obs_i â”€â”€â–¶ [MLP] â”€â”€â–¶ tanh â”€â”€â–¶ action_i                        â”‚
â”‚                                                                             â”‚
â”‚   Critic Q_i: [obs_all, action_all] â”€â”€â–¶ [MLP] â”€â”€â–¶ Q_i                      â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚                      Centralized Critic                          â”‚      â”‚
â”‚   â”‚                                                                 â”‚      â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”                   â”‚      â”‚
â”‚   â”‚   â”‚ obs_1 â”‚ â”‚ obs_2 â”‚ â”‚ obs_N â”‚    â”‚action â”‚                   â”‚      â”‚
â”‚   â”‚   â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜    â”‚ _all  â”‚                   â”‚      â”‚
â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”˜                   â”‚      â”‚
â”‚   â”‚                                        â”‚                        â”‚      â”‚
â”‚   â”‚                                   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                   â”‚      â”‚
â”‚   â”‚                                   â”‚  Concat â”‚                   â”‚      â”‚
â”‚   â”‚                                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                   â”‚      â”‚
â”‚   â”‚                                        â”‚                        â”‚      â”‚
â”‚   â”‚                                   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                   â”‚      â”‚
â”‚   â”‚                                   â”‚   MLP   â”‚                   â”‚      â”‚
â”‚   â”‚                                   â”‚ 256,256 â”‚                   â”‚      â”‚
â”‚   â”‚                                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                   â”‚      â”‚
â”‚   â”‚                                        â”‚                        â”‚      â”‚
â”‚   â”‚                                   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                   â”‚      â”‚
â”‚   â”‚                                   â”‚   Q_i   â”‚                   â”‚      â”‚
â”‚   â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                             â”‚
â”‚   è®­ç»ƒ:                                                                     â”‚
â”‚   - Actor:  âˆ‡_Î¸ J = E[âˆ‡_a Q_i(s,a)|_{a=Î¼(s)} Â· âˆ‡_Î¸ Î¼_i(s)]                â”‚
â”‚   - Critic: L = (Q_i - (r + Î³Â·Q_i'(s',Î¼'(s'))))Â²                          â”‚
â”‚   - è½¯æ›´æ–°: Î¸' â† Ï„Î¸ + (1-Ï„)Î¸'                                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…­ã€å®‰å…¨æ»¤æ³¢å™¨æ¶æ„

### 6.1 CBF (Control Barrier Function)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CBF å®‰å…¨æ»¤æ³¢å™¨                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   å®‰å…¨çº¦æŸå®šä¹‰:                                                              â”‚
â”‚                                                                             â”‚
â”‚   1. ç¢°æ’é¿å… (agent-agent):                                                â”‚
â”‚      h_ij(x) = ||p_i - p_j||Â² - d_safeÂ²                                    â”‚
â”‚      å®‰å…¨æ¡ä»¶: h_ij(x) â‰¥ 0                                                  â”‚
â”‚                                                                             â”‚
â”‚   2. è¾¹ç•Œçº¦æŸ (boundary):                                                   â”‚
â”‚      h_b(x) = (arena_size/2)Â² - ||p_i||Â²                                   â”‚
â”‚                                                                             â”‚
â”‚   3. éšœç¢ç‰©é¿å… (obstacle):                                                 â”‚
â”‚      h_obs(x) = ||p_i - p_obs||Â² - r_obsÂ²                                  â”‚
â”‚                                                                             â”‚
â”‚   CBF æ¡ä»¶ (ç¡®ä¿å‰å‘ä¸å˜æ€§):                                                â”‚
â”‚      á¸£(x,u) + Î±Â·h(x) â‰¥ 0                                                   â”‚
â”‚                                                                             â”‚
â”‚   QP å½¢å¼:                                                                  â”‚
â”‚      min  ||u - u_nom||Â²                                                   â”‚
â”‚      s.t. AÂ·u â‰¥ b                                                          â”‚
â”‚                                                                             â”‚
â”‚      å…¶ä¸­: A = âˆ‚h/âˆ‚x Â· g(x)                                                â”‚
â”‚            b = -âˆ‚h/âˆ‚x Â· f(x) - Î±Â·h(x)                                      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 COSMOS (Coordinated Safety on Manifold)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         COSMOS å®‰å…¨æ»¤æ³¢å™¨                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚                     çº¦æŸæµå½¢æŠ•å½±                                  â”‚      â”‚
â”‚   â”‚                                                                 â”‚      â”‚
â”‚   â”‚   çº¦æŸ: c(q) = 0  (ç¼–é˜Ÿçº¦æŸã€è¿é€šæ€§çº¦æŸç­‰)                        â”‚      â”‚
â”‚   â”‚                                                                 â”‚      â”‚
â”‚   â”‚   é›…å¯æ¯”: J = âˆ‚c/âˆ‚q                                             â”‚      â”‚
â”‚   â”‚                                                                 â”‚      â”‚
â”‚   â”‚   é›¶ç©ºé—´æŠ•å½±: N = I - J^+ Â· J                                   â”‚      â”‚
â”‚   â”‚                                                                 â”‚      â”‚
â”‚   â”‚   å®‰å…¨åŠ¨ä½œ: u* = N Â· u_nom + J^+ Â· (-Î±Â·c(q))                    â”‚      â”‚
â”‚   â”‚                â†‘              â†‘                                 â”‚      â”‚
â”‚   â”‚           é›¶ç©ºé—´åˆ†é‡      çº¦æŸæ ¡æ­£åˆ†é‡                            â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚                      RMPflow é›†æˆ                                â”‚      â”‚
â”‚   â”‚                                                                 â”‚      â”‚
â”‚   â”‚   RMP Tree:                                                     â”‚      â”‚
â”‚   â”‚                                                                 â”‚      â”‚
â”‚   â”‚          root (task space)                                      â”‚      â”‚
â”‚   â”‚           /    |    \                                           â”‚      â”‚
â”‚   â”‚         /      |      \                                         â”‚      â”‚
â”‚   â”‚       goal  obstacle  formation                                 â”‚      â”‚
â”‚   â”‚       RMP     RMP       RMP                                     â”‚      â”‚
â”‚   â”‚                                                                 â”‚      â”‚
â”‚   â”‚   Pullback: ä»å¶èŠ‚ç‚¹å‘æ ¹èŠ‚ç‚¹ä¼ é€’ (f, M)                          â”‚      â”‚
â”‚   â”‚   Resolve:  a = M^{-1} Â· f                                      â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸ƒã€é…ç½®ç³»ç»Ÿ

### 7.1 Hydra é…ç½®å±‚æ¬¡

```
configs/
â”œâ”€â”€ config.yaml              # é»˜è®¤é…ç½® + defaults ç»„åˆ
â”‚   defaults:
â”‚   - env: formation_nav
â”‚   - algo: mappo
â”‚   - safety: cosmos
â”‚
â”œâ”€â”€ env/                     # ç¯å¢ƒé…ç½®ç»„
â”‚   â”œâ”€â”€ formation_nav.yaml
â”‚   â”œâ”€â”€ epuck_sim.yaml
â”‚   â””â”€â”€ safety_gym.yaml
â”‚
â”œâ”€â”€ algo/                    # ç®—æ³•é…ç½®ç»„
â”‚   â”œâ”€â”€ mappo.yaml
â”‚   â”œâ”€â”€ qmix.yaml
â”‚   â””â”€â”€ maddpg.yaml
â”‚
â””â”€â”€ safety/                  # å®‰å…¨é…ç½®ç»„
    â”œâ”€â”€ cosmos.yaml
    â”œâ”€â”€ cbf.yaml
    â””â”€â”€ none.yaml
```

### 7.2 é…ç½®è¦†ç›–ç¤ºä¾‹

```bash
# åŸºç¡€è¿è¡Œ
python -m cosmos.train

# åˆ‡æ¢ç¯å¢ƒ
python -m cosmos.train env=epuck_sim

# åˆ‡æ¢ç®—æ³•
python -m cosmos.train algo=qmix

# è¦†ç›–å‚æ•°
python -m cosmos.train env.num_agents=6 algo.actor_lr=1e-4

# å¤šé…ç½® sweep
python -m cosmos.train -m algo=mappo,qmix,maddpg env.num_agents=4,6,8
```

---

## å…«ã€ROS2 éƒ¨ç½²æ¶æ„

### 8.1 èŠ‚ç‚¹é€šä¿¡å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ROS2 èŠ‚ç‚¹é€šä¿¡                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚   â”‚     Webots      â”‚          â”‚  Formation      â”‚                         â”‚
â”‚   â”‚   Simulation    â”‚          â”‚  Controller     â”‚                         â”‚
â”‚   â”‚                 â”‚          â”‚                 â”‚                         â”‚
â”‚   â”‚  /epuck{i}/odom â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚                         â”‚
â”‚   â”‚  /epuck{i}/prox â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Compute       â”‚                         â”‚
â”‚   â”‚                 â”‚          â”‚   nominal       â”‚                         â”‚
â”‚   â”‚                 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   actions       â”‚                         â”‚
â”‚   â”‚  /epuck{i}/     â”‚          â”‚                 â”‚                         â”‚
â”‚   â”‚    cmd_vel      â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚                                  â”‚
â”‚                                         â”‚                                  â”‚
â”‚                                         â–¼                                  â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                              â”‚  Safety Filter  â”‚                           â”‚
â”‚                              â”‚     Node        â”‚                           â”‚
â”‚                              â”‚                 â”‚                           â”‚
â”‚                              â”‚  CBF/COSMOS     â”‚                           â”‚
â”‚                              â”‚  projection     â”‚                           â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                       â”‚                                    â”‚
â”‚                                       â–¼                                    â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                              â”‚  MAPPO Policy   â”‚                           â”‚
â”‚                              â”‚     Node        â”‚                           â”‚
â”‚                              â”‚                 â”‚                           â”‚
â”‚                              â”‚  Trained model  â”‚                           â”‚
â”‚                              â”‚  inference      â”‚                           â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                             â”‚
â”‚   è¯é¢˜:                                                                     â”‚
â”‚   /epuck{i}/odom      - nav_msgs/Odometry     - æœºå™¨äººä½å§¿                 â”‚
â”‚   /epuck{i}/proximity - Float32MultiArray     - 8ä¸ªçº¢å¤–ä¼ æ„Ÿå™¨               â”‚
â”‚   /epuck{i}/cmd_vel   - geometry_msgs/Twist   - é€Ÿåº¦å‘½ä»¤                   â”‚
â”‚   /formation/goal     - PoseStamped           - ç¼–é˜Ÿç›®æ ‡                   â”‚
â”‚   /formation/status   - String                - ç¼–é˜ŸçŠ¶æ€                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¹ã€æ‰©å±•æŒ‡å—

### 9.1 æ·»åŠ æ–°ç¯å¢ƒ

```python
# cosmos/envs/my_env.py
from cosmos.registry import ENV_REGISTRY
from cosmos.envs.base import BaseMultiAgentEnv

@ENV_REGISTRY.register("my_env")
class MyEnv(BaseMultiAgentEnv):
    def __init__(self, cfg=None, **kwargs):
        # åˆå§‹åŒ–
        pass

    @property
    def num_agents(self):
        return self._num_agents

    def reset(self, seed=None):
        # è¿”å› (obs, share_obs, info)
        pass

    def step(self, actions):
        # è¿”å› (obs, share_obs, rewards, costs, dones, infos, truncated)
        pass

    def get_constraint_info(self):
        # è¿”å›å®‰å…¨æ»¤æ³¢å™¨æ‰€éœ€ä¿¡æ¯
        return {"positions": ..., "velocities": ...}
```

### 9.2 æ·»åŠ æ–°ç®—æ³•

```python
# cosmos/algos/my_algo.py
from cosmos.registry import ALGO_REGISTRY
from cosmos.algos.base import BaseMARLAlgo

@ALGO_REGISTRY.register("my_algo")
class MyAlgo(BaseMARLAlgo):
    def __init__(self, obs_dim, share_obs_dim, act_dim, num_agents, cfg=None, **kwargs):
        # åˆå§‹åŒ–ç½‘ç»œ
        pass

    def get_actions(self, obs, deterministic=False):
        # è¿”å› (actions, log_probs)
        pass

    def get_values(self, share_obs):
        # è¿”å› values
        pass

    def update(self, buffer):
        # æ›´æ–°ç½‘ç»œï¼Œè¿”å› loss metrics
        pass
```

### 9.3 æ·»åŠ æ–°å®‰å…¨æ»¤æ³¢å™¨

```python
# cosmos/safety/my_filter.py
from cosmos.registry import SAFETY_REGISTRY
from cosmos.safety.base import BaseSafetyFilter

@SAFETY_REGISTRY.register("my_filter")
class MyFilter(BaseSafetyFilter):
    def __init__(self, env_cfg, safety_cfg=None, **kwargs):
        # åˆå§‹åŒ–
        pass

    def reset(self, constraint_info):
        # é‡ç½®æ»¤æ³¢å™¨çŠ¶æ€
        pass

    def project(self, actions, constraint_info):
        # æŠ•å½±åŠ¨ä½œåˆ°å®‰å…¨ç©ºé—´
        # è¿”å› safe_actions
        pass
```

---

## åã€æ€§èƒ½æŒ‡æ ‡

| ç»„ä»¶ | æŒ‡æ ‡ | å…¸å‹å€¼ |
|------|------|--------|
| formation_nav | è®­ç»ƒé€Ÿåº¦ | ~10,000 steps/sec |
| epuck_sim | è®­ç»ƒé€Ÿåº¦ | ~5,000 steps/sec |
| safety_gym | è®­ç»ƒé€Ÿåº¦ | ~1,000 steps/sec |
| CBF æ»¤æ³¢ | å»¶è¿Ÿ | < 1 ms |
| MAPPO æ¨ç† | å»¶è¿Ÿ | < 0.5 ms |
| QMIX æ¨ç† | å»¶è¿Ÿ | < 0.3 ms |

---

## åä¸€ã€å‚è€ƒæ–‡çŒ®

| æ–¹æ³• | è®ºæ–‡ | ç”¨é€” |
|------|------|------|
| ATACOM | Liu et al., CoRL 2021 | çº¦æŸæµå½¢æŠ•å½± |
| CBF | Ames et al., 2017 | æ§åˆ¶å±éšœå‡½æ•° |
| RMPflow | Cheng et al., WAFR 2018 | å‡ ä½•è¿åŠ¨ç­–ç•¥ |
| MAPPO | Yu et al., NeurIPS 2022 | å¤šæ™ºèƒ½ä½“ PPO |
| QMIX | Rashid et al., ICML 2018 | å€¼åˆ†è§£ |
| MADDPG | Lowe et al., NeurIPS 2017 | å¤šæ™ºèƒ½ä½“ DDPG |
