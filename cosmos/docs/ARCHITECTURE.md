# COSMOS è¯¦ç»†æ¶æ„æ–‡æ¡£

## ä¸€ã€ç¨‹åºæ¸…å•

æ‰€æœ‰ä»£ç å·²æ•´åˆåˆ° `cosmos/` ç›®å½•ä¸‹:

| ç¨‹åº | å…¥å£ | åŠŸèƒ½ |
|------|------|------|
| **COSMOS è®­ç»ƒ** | `python -m cosmos.train` | ç»Ÿä¸€è®­ç»ƒæ¡†æ¶ |
| **ç¼–é˜Ÿå¯¼èˆªæ¼”ç¤º** | `python -m cosmos.apps.formation_nav.demo` | å¯è§†åŒ–æ¼”ç¤º |
| **åŸºå‡†æµ‹è¯•** | `python -m cosmos.apps.formation_nav.benchmark` | æ€§èƒ½å¯¹æ¯” |
| **æµ‹è¯•å¥—ä»¶** | `python tests/test_all_envs.py` | ç»„ä»¶æµ‹è¯• |
| **ROS2 éƒ¨ç½²** | `ros2 launch epuck_formation ...` | æœºå™¨äººéƒ¨ç½² |

---

## äºŒã€ç›®å½•ç»“æ„è¯¦è§£

```
safe-rl-manifold-suite/
â”‚
â”œâ”€â”€ cosmos/                          # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚                                # ç»Ÿä¸€æ¡†æ¶ (æ‰€æœ‰ä»£ç æ•´åˆäºæ­¤)
â”‚   â”‚                                # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ train.py                     # ğŸ“Œ è®­ç»ƒå…¥å£: python -m cosmos.train
â”‚   â”œâ”€â”€ trainer.py                   # è®­ç»ƒå™¨ (è®­ç»ƒå¾ªç¯ã€æ—¥å¿—ã€æ£€æŸ¥ç‚¹)
â”‚   â”œâ”€â”€ registry.py                  # ç»„ä»¶æ³¨å†Œå™¨ (ENV/ALGO/SAFETY_REGISTRY)
â”‚   â”‚
â”‚   â”œâ”€â”€ configs/                     # Hydra é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ config.yaml              # ä¸»é…ç½® (defaults ç»„åˆ)
â”‚   â”‚   â”œâ”€â”€ env/                     # ç¯å¢ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ algo/                    # ç®—æ³•é…ç½®
â”‚   â”‚   â””â”€â”€ safety/                  # å®‰å…¨æ»¤æ³¢é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ envs/                        # ç¯å¢ƒå±‚
â”‚   â”‚   â”œâ”€â”€ base.py                  # BaseMultiAgentEnv åŸºç±»
â”‚   â”‚   â”œâ”€â”€ formation_nav.py         # ç¼–é˜Ÿå¯¼èˆªç¯å¢ƒ
â”‚   â”‚   â”œâ”€â”€ formations.py            # ç¼–é˜Ÿå½¢çŠ¶ä¸æ‹“æ‰‘
â”‚   â”‚   â”œâ”€â”€ webots_wrapper.py        # Webots/E-puck
â”‚   â”‚   â”œâ”€â”€ epuck_visualizer.py      # E-puck å¯è§†åŒ–
â”‚   â”‚   â”œâ”€â”€ safety_gym_wrapper.py    # Safety-Gymnasium
â”‚   â”‚   â”œâ”€â”€ mujoco_wrapper.py        # MuJoCo
â”‚   â”‚   â””â”€â”€ vmas_wrapper.py          # VMAS
â”‚   â”‚
â”‚   â”œâ”€â”€ algos/                       # ç®—æ³•å±‚
â”‚   â”‚   â”œâ”€â”€ base.py                  # BaseMARLAlgo åŸºç±»
â”‚   â”‚   â”œâ”€â”€ mappo.py                 # MAPPO
â”‚   â”‚   â”œâ”€â”€ qmix.py                  # QMIX
â”‚   â”‚   â””â”€â”€ maddpg.py                # MADDPG
â”‚   â”‚
â”‚   â”œâ”€â”€ safety/                      # å®‰å…¨å±‚
â”‚   â”‚   â”œâ”€â”€ base.py                  # BaseSafetyFilter åŸºç±»
â”‚   â”‚   â”œâ”€â”€ cosmos_filter.py         # CBF æ»¤æ³¢å™¨
â”‚   â”‚   â”œâ”€â”€ atacom.py                # ATACOM æµå½¢æŠ•å½±
â”‚   â”‚   â”œâ”€â”€ constraints.py           # çº¦æŸå®šä¹‰
â”‚   â”‚   â”œâ”€â”€ rmp_tree.py              # RMPflow æ ‘
â”‚   â”‚   â””â”€â”€ rmp_policies.py          # RMP ç­–ç•¥
â”‚   â”‚
â”‚   â”œâ”€â”€ buffers/                     # ç¼“å†²åŒº
â”‚   â”‚   â”œâ”€â”€ rollout_buffer.py        # On-policy (GAE)
â”‚   â”‚   â””â”€â”€ replay_buffer.py         # Off-policy (PER)
â”‚   â”‚
â”‚   â”œâ”€â”€ runners/                     # è¿è¡Œå™¨
â”‚   â”‚   â”œâ”€â”€ episode_runner.py        # å•çº¿ç¨‹
â”‚   â”‚   â””â”€â”€ parallel_runner.py       # å¹¶è¡Œ
â”‚   â”‚
â”‚   â””â”€â”€ apps/                        # åº”ç”¨å±‚
â”‚       â””â”€â”€ formation_nav/           # ç¼–é˜Ÿå¯¼èˆªåº”ç”¨
â”‚           â”œâ”€â”€ config.py            # åº”ç”¨é…ç½®
â”‚           â”œâ”€â”€ demo.py              # ğŸ“Œ python -m cosmos.apps.formation_nav.demo
â”‚           â”œâ”€â”€ demo_visualization.py
â”‚           â”œâ”€â”€ benchmark.py         # ğŸ“Œ python -m cosmos.apps.formation_nav.benchmark
â”‚           â””â”€â”€ docs/                # ç†è®ºæ–‡æ¡£
â”‚
â”œâ”€â”€ tests/                           # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚                                # ç¨‹åº3: æµ‹è¯•å¥—ä»¶
â”‚   â”‚                                # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â””â”€â”€ test_all_envs.py             # ğŸ“Œ ä¸»å…¥å£: python tests/test_all_envs.py
â”‚
â”œâ”€â”€ examples/                        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚                                # ç¤ºä¾‹ä¸æ¼”ç¤º
â”‚   â”‚                                # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â””â”€â”€ Epuck_Colab_Demo.ipynb       # Google Colab æ¼”ç¤º Notebook
â”‚
â”œâ”€â”€ ros2_ws/                         # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚                                # ç¨‹åº4: ROS2 éƒ¨ç½²
â”‚   â”‚                                # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â””â”€â”€ src/epuck_formation/
â”‚       â”œâ”€â”€ package.xml              # ROS2 åŒ…é…ç½®
â”‚       â”œâ”€â”€ CMakeLists.txt
â”‚       â”œâ”€â”€ launch/
â”‚       â”‚   â””â”€â”€ epuck_formation.launch.py  # ğŸ“Œ ros2 launch ...
â”‚       â”œâ”€â”€ scripts/
â”‚       â”‚   â””â”€â”€ formation_controller.py   # ç¼–é˜Ÿæ§åˆ¶èŠ‚ç‚¹
â”‚       â”œâ”€â”€ worlds/
â”‚       â”‚   â””â”€â”€ epuck_arena.wbt      # Webots ä»¿çœŸä¸–ç•Œ
â”‚       â””â”€â”€ config/
â”‚           â””â”€â”€ formation_params.yaml
â”‚
â”œâ”€â”€ scripts/                         # å·¥å…·è„šæœ¬
â”‚   â””â”€â”€ analyze_results.py           # ç»“æœåˆ†æä¸ç»˜å›¾
â”‚
â”œâ”€â”€ docs/                            # æ–‡æ¡£
â”‚   â””â”€â”€ ROS2_WEBOTS_SETUP.md         # ROS2/Webots å®‰è£…æŒ‡å—
â”‚
â”œâ”€â”€ refs/                            # å‚è€ƒæ–‡çŒ® (PDF/ç¬”è®°)
â”œâ”€â”€ paper/                           # è®ºæ–‡èµ„æ–™
â”‚
â”œâ”€â”€ algorithms/                      # Git å­æ¨¡å— (å¤–éƒ¨å¼•ç”¨)
â”‚   â”œâ”€â”€ multi-robot-rmpflow/         # RMPflow å‚è€ƒå®ç°
â”‚   â””â”€â”€ safe-po/                     # å®‰å…¨ç­–ç•¥ä¼˜åŒ–å‚è€ƒ
â”‚
â”œâ”€â”€ envs/                            # Git å­æ¨¡å— (å¤–éƒ¨å¼•ç”¨)
â”‚   â””â”€â”€ safety-gymnasium/            # Safety-Gym å‚è€ƒ
â”‚
â”œâ”€â”€ artifacts/                       # ç”Ÿæˆæ•°æ® (gitignored)
â”‚   â”œâ”€â”€ checkpoints/                 # æ¨¡å‹æ£€æŸ¥ç‚¹
â”‚   â”œâ”€â”€ demo_output/                 # æ¼”ç¤ºè¾“å‡º
â”‚   â”œâ”€â”€ outputs/                     # Hydra è¾“å‡º
â”‚   â””â”€â”€ results/                     # å®éªŒç»“æœ
â”‚
â”œâ”€â”€ setup.sh                         # å®‰è£…è„šæœ¬ (Conda)
â”œâ”€â”€ setup.py                         # pip å®‰è£…é…ç½®
â”œâ”€â”€ run_experiments.sh               # æ‰¹é‡å®éªŒè„šæœ¬
â”œâ”€â”€ requirements.txt                 # Python ä¾èµ–
â”œâ”€â”€ README.md                        # é¡¹ç›®è¯´æ˜
â””â”€â”€ CLAUDE.md                        # Claude AI å¼€å‘æŒ‡å—
```

---

## ä¸‰ã€ç¨‹åºæ¶æ„å›¾

### 3.1 COSMOS æ¡†æ¶æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         COSMOS Framework                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                          train.py (å…¥å£)                             â”‚  â”‚
â”‚   â”‚                              â”‚                                       â”‚  â”‚
â”‚   â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                              â”‚  â”‚
â”‚   â”‚                      â”‚    Hydra      â”‚                              â”‚  â”‚
â”‚   â”‚                      â”‚   é…ç½®åŠ è½½     â”‚                              â”‚  â”‚
â”‚   â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚  â”‚
â”‚   â”‚                              â”‚                                       â”‚  â”‚
â”‚   â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                              â”‚  â”‚
â”‚   â”‚                      â”‚   Trainer     â”‚                              â”‚  â”‚
â”‚   â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚                                          â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚          â”‚                       â”‚                       â”‚                 â”‚
â”‚          â–¼                       â–¼                       â–¼                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚ ENV_REGISTRYâ”‚         â”‚ALGO_REGISTRYâ”‚         â”‚SAFETY_REGIS â”‚         â”‚
â”‚   â”‚             â”‚         â”‚             â”‚         â”‚             â”‚         â”‚
â”‚   â”‚ formation   â”‚         â”‚   mappo     â”‚         â”‚    cbf      â”‚         â”‚
â”‚   â”‚ epuck_sim   â”‚         â”‚   qmix      â”‚         â”‚   cosmos    â”‚         â”‚
â”‚   â”‚ safety_gym  â”‚         â”‚   maddpg    â”‚         â”‚    none     â”‚         â”‚
â”‚   â”‚ mujoco      â”‚         â”‚             â”‚         â”‚             â”‚         â”‚
â”‚   â”‚ vmas        â”‚         â”‚             â”‚         â”‚             â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚          â”‚                       â”‚                       â”‚                 â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                  â”‚                                          â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                          â”‚    Runner     â”‚                                 â”‚
â”‚                          â”‚   + Buffer    â”‚                                 â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç¼–é˜Ÿå¯¼èˆªæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Formation Navigation                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                          train.py (å…¥å£)                             â”‚  â”‚
â”‚   â”‚                              â”‚                                       â”‚  â”‚
â”‚   â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                              â”‚  â”‚
â”‚   â”‚                      â”‚   Config      â”‚                              â”‚  â”‚
â”‚   â”‚                      â”‚  (dataclass)  â”‚                              â”‚  â”‚
â”‚   â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚                                          â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚          â”‚                       â”‚                       â”‚                 â”‚
â”‚          â–¼                       â–¼                       â–¼                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚     env/    â”‚         â”‚    algo/    â”‚         â”‚   safety/   â”‚         â”‚
â”‚   â”‚             â”‚         â”‚             â”‚         â”‚             â”‚         â”‚
â”‚   â”‚ formation   â”‚         â”‚   MAPPO     â”‚         â”‚  ATACOM     â”‚         â”‚
â”‚   â”‚ _env.py     â”‚         â”‚  networks   â”‚         â”‚  COSMOS     â”‚         â”‚
â”‚   â”‚ formations  â”‚         â”‚  buffer     â”‚         â”‚  RMPflow    â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                             â”‚
â”‚   ç‰¹ç‚¹:                                                                     â”‚
â”‚   - ç‹¬ç«‹çš„ MAPPO å®ç°                                                       â”‚
â”‚   - ATACOM + COSMOS + RMPflow é›†æˆ                                         â”‚
â”‚   - é¢å‘è®ºæ–‡çš„å®Œæ•´å®ç°                                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ROS2 éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ROS2 Deployment                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      è¯é¢˜è®¢é˜…      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   Webots    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚    formation_controller.py     â”‚   â”‚
â”‚   â”‚ Simulation  â”‚   /epuck{i}/odom   â”‚                                 â”‚   â”‚
â”‚   â”‚             â”‚   /epuck{i}/prox   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                    â”‚   â”‚     COSMOS/CBF          â”‚   â”‚   â”‚
â”‚   â”‚ â”‚ E-puck0 â”‚ â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚    Safety Filter        â”‚   â”‚   â”‚
â”‚   â”‚ â”‚ E-puck1 â”‚ â”‚   /epuck{i}/cmd_velâ”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚ â”‚ E-puck2 â”‚ â”‚                    â”‚                                 â”‚   â”‚
â”‚   â”‚ â”‚ E-puck3 â”‚ â”‚                    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                    â”‚   â”‚     MAPPO Policy        â”‚   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚    (trained model)      â”‚   â”‚   â”‚
â”‚                                      â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   è¯é¢˜:                                                                     â”‚
â”‚   â”œâ”€ /epuck{i}/odom       (nav_msgs/Odometry)     æœºå™¨äººä½å§¿               â”‚
â”‚   â”œâ”€ /epuck{i}/proximity  (Float32MultiArray)     çº¢å¤–ä¼ æ„Ÿå™¨               â”‚
â”‚   â”œâ”€ /epuck{i}/cmd_vel    (geometry_msgs/Twist)   é€Ÿåº¦å‘½ä»¤                 â”‚
â”‚   â”œâ”€ /formation/goal      (PoseStamped)           ç¼–é˜Ÿç›®æ ‡                 â”‚
â”‚   â””â”€ /formation/status    (String)                ç¼–é˜ŸçŠ¶æ€                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€ç±»ç»§æ‰¿å…³ç³»

### 4.1 ç¯å¢ƒç±»

```
gym.Env (ABC)
    â”‚
    â””â”€â”€ BaseMultiAgentEnv (cosmos/envs/base.py)
            â”‚
            â”œâ”€â”€ FormationNavEnv        # ç¼–é˜Ÿå¯¼èˆª
            â”œâ”€â”€ EpuckSimEnv            # E-puck ä»¿çœŸ
            â”œâ”€â”€ WebotsEpuckEnv         # Webots E-puck
            â”œâ”€â”€ SafetyGymWrapper       # Safety-Gymnasium
            â”œâ”€â”€ MuJoCoWrapper          # MuJoCo
            â””â”€â”€ VMASWrapper            # VMAS
```

### 4.2 ç®—æ³•ç±»

```
BaseMARLAlgo (ABC)
    â”‚
    â”œâ”€â”€ MAPPO                          # On-policy, Actor-Critic
    â”‚   â”œâ”€â”€ Actor (MLP + Gaussian)
    â”‚   â””â”€â”€ Critic (MLP)
    â”‚
    â”œâ”€â”€ QMIX                           # Off-policy, Value-based
    â”‚   â”œâ”€â”€ AgentNetwork (GRU)
    â”‚   â””â”€â”€ MixingNetwork (Hypernetwork)
    â”‚
    â””â”€â”€ MADDPG                         # Off-policy, Actor-Critic
        â”œâ”€â”€ Actor (Deterministic)
        â””â”€â”€ CentralizedCritic
```

### 4.3 å®‰å…¨æ»¤æ³¢ç±»

```
BaseSafetyFilter (ABC)
    â”‚
    â”œâ”€â”€ CBFFilter                      # Control Barrier Function
    â”‚   â””â”€â”€ _solve_cbf_qp()            # QP æ±‚è§£å™¨
    â”‚
    â”œâ”€â”€ COSMOSFilter                   # çº¦æŸæµå½¢æŠ•å½±
    â”‚   â”œâ”€â”€ _project_to_manifold()     # é›¶ç©ºé—´æŠ•å½±
    â”‚   â””â”€â”€ _rmpflow_correction()      # RMPflow ä¿®æ­£
    â”‚
    â””â”€â”€ NoFilter                       # ç›´é€š (åŸºçº¿)
```

---

## äº”ã€æ•°æ®æµ

### 5.1 è®­ç»ƒæ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Training Loop                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  for episode in range(num_episodes):                                     â”‚
â”‚      â”‚                                                                   â”‚
â”‚      â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      â”‚
â”‚  â”‚  env.reset()   â”‚ â”€â”€â–¶ obs (N, obs_dim), share_obs (N, share_dim)      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚
â”‚          â”‚                                                               â”‚
â”‚          â–¼                                                               â”‚
â”‚  for step in range(max_steps):                                           â”‚
â”‚      â”‚                                                                   â”‚
â”‚      â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  actions, log_probs = policy.get_actions(obs)                  â”‚     â”‚
â”‚  â”‚  values = critic.get_values(share_obs)                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                              â”‚                                           â”‚
â”‚                              â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  constraint_info = env.get_constraint_info()                   â”‚     â”‚
â”‚  â”‚  safe_actions = safety_filter.project(actions, constraint_info)â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                              â”‚                                           â”‚
â”‚                              â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  next_obs, share_obs, rewards, costs, dones, infos, _ =        â”‚     â”‚
â”‚  â”‚      env.step(safe_actions)                                    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                              â”‚                                           â”‚
â”‚                              â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  buffer.insert(obs, actions, rewards, costs, values, log_probs)â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                              â”‚                                           â”‚
â”‚  end for step               â”‚                                           â”‚
â”‚      â”‚                      â”‚                                           â”‚
â”‚      â–¼                      â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  buffer.compute_returns_and_advantages()                       â”‚     â”‚
â”‚  â”‚  loss = policy.update(buffer)                                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                          â”‚
â”‚  end for episode                                                         â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 CBF å®‰å…¨æ»¤æ³¢æ•°æ®æµ

```
è¾“å…¥: u_nom (N, act_dim), constraint_info

for each agent pair (i, j):
    â”‚
    â”œâ”€â”€ è®¡ç®—è·ç¦»: d_ij = ||p_i - p_j||
    â”‚
    â”œâ”€â”€ æ„å»º CBF: h_ij = d_ijÂ² - d_safeÂ²
    â”‚
    â””â”€â”€ CBF æ¡ä»¶: á¸£_ij + Î±Â·h_ij â‰¥ 0
                  â–¼
        âˆ‚h/âˆ‚p Â· (v + BÂ·u) + Î±Â·h â‰¥ 0
                  â–¼
        AÂ·u â‰¥ b  (çº¿æ€§çº¦æŸ)

QP æ±‚è§£:
    min  ||u - u_nom||Â²
    s.t. AÂ·u â‰¥ b
         u_min â‰¤ u â‰¤ u_max
              â”‚
              â–¼
    ä½¿ç”¨æŠ•å½±æ¢¯åº¦ä¸‹é™æ±‚è§£:
    u â† u - Î·Â·(u - u_nom)
    u â† u + Î·Â·A^TÂ·max(0, b - AÂ·u)
              â”‚
              â–¼
è¾“å‡º: u_safe (N, act_dim)
```

---

## å…­ã€é…ç½®ç³»ç»Ÿ

### 6.1 COSMOS (Hydra)

```yaml
# cosmos/configs/config.yaml
defaults:
  - env: formation_nav      # ä» env/ ç›®å½•åŠ è½½
  - algo: mappo             # ä» algo/ ç›®å½•åŠ è½½
  - safety: cbf             # ä» safety/ ç›®å½•åŠ è½½

experiment:
  name: cosmos_exp
  seed: 42
  num_episodes: 200

# å‘½ä»¤è¡Œè¦†ç›–:
# python -m cosmos.train env=epuck_sim algo=qmix env.num_agents=6
```

### 6.2 Formation Nav (dataclass)

```python
# formation_nav/config.py
@dataclass
class Config:
    # Environment
    num_agents: int = 4
    formation: str = "square"
    arena_size: float = 5.0

    # Algorithm
    actor_lr: float = 3e-4
    ppo_epochs: int = 10

    # Safety
    use_safety: bool = True
    safety_mode: str = "cosmos"

# å‘½ä»¤è¡Œè¦†ç›–:
# python train.py --num_agents 6 --formation hexagon
```

---

## ä¸ƒã€æ‰©å±•æŒ‡å—

### 7.1 æ·»åŠ æ–°ç¯å¢ƒ

1. åˆ›å»ºç¯å¢ƒç±»:
```python
# cosmos/envs/my_env.py
@ENV_REGISTRY.register("my_env")
class MyEnv(BaseMultiAgentEnv):
    ...
```

2. åˆ›å»ºé…ç½®:
```yaml
# cosmos/configs/env/my_env.yaml
name: my_env
param1: value1
```

3. æ›´æ–° `__init__.py`:
```python
from cosmos.envs.my_env import MyEnv
```

### 7.2 æ·»åŠ æ–°ç®—æ³•

1. åˆ›å»ºç®—æ³•ç±»:
```python
# cosmos/algos/my_algo.py
@ALGO_REGISTRY.register("my_algo")
class MyAlgo(BaseMARLAlgo):
    ...
```

2. åˆ›å»ºé…ç½®:
```yaml
# cosmos/configs/algo/my_algo.yaml
name: my_algo
learning_rate: 3e-4
```

---

## å…«ã€æ€§èƒ½å‚è€ƒ

| ç»„ä»¶ | æŒ‡æ ‡ | å‚è€ƒå€¼ |
|------|------|--------|
| formation_nav è®­ç»ƒ | é€Ÿåº¦ | ~10,000 steps/sec |
| epuck_sim è®­ç»ƒ | é€Ÿåº¦ | ~5,000 steps/sec |
| safety_gym è®­ç»ƒ | é€Ÿåº¦ | ~1,000 steps/sec |
| CBF æ»¤æ³¢ | å»¶è¿Ÿ | < 1 ms |
| MAPPO æ¨ç† | å»¶è¿Ÿ | < 0.5 ms |
| ç¢°æ’ç‡ (with CBF) | å®‰å…¨æ€§ | 0% |

---

## ä¹ã€å‚è€ƒæ–‡çŒ®

1. Liu et al., "Robot Reinforcement Learning on the Constraint Manifold", CoRL 2021
2. Ames et al., "Control Barrier Functions: Theory and Applications", 2017
3. Cheng et al., "RMPflow: A Computational Graph for Automatic Motion Policy Generation", WAFR 2018
4. Yu et al., "The Surprising Effectiveness of PPO in Cooperative Multi-Agent Games", NeurIPS 2022
5. Rashid et al., "QMIX: Monotonic Value Function Factorisation", ICML 2018
6. Lowe et al., "Multi-Agent Actor-Critic for Mixed Cooperative-Competitive Environments", NeurIPS 2017
